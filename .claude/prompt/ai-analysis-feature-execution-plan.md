# AIæ™ºèƒ½åˆ†æåŠŸèƒ½æ‰§è¡Œè®¡åˆ’

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

ä¸º SkillCount åº”ç”¨çš„æ•°æ®åˆ†æé¡µé¢æ·»åŠ åŸºäºå†å²è®­ç»ƒè®°å½•çš„AIæ™ºèƒ½åˆ†æåŠŸèƒ½ï¼Œä½¿ç”¨ç«å±±äº‘å¼•æ“APIæä¾›æ™ºèƒ½è®­ç»ƒå»ºè®®å’Œä¸ªæ€§åŒ–åˆ†ææŠ¥å‘Šï¼ŒåŒæ—¶ä¸ºæœªæ¥é›†æˆDify AI Agenté¢„ç•™æ‰©å±•ç‚¹ã€‚

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

- **æ™ºèƒ½åˆ†æ**ï¼šåŸºäºå†å²è®­ç»ƒæ•°æ®ï¼ŒAIåˆ†æç”¨æˆ·çš„è®­ç»ƒè¡¨ç°å’Œè¿›æ­¥è¶‹åŠ¿
- **ä¸ªæ€§åŒ–å»ºè®®**ï¼šæä¾›é’ˆå¯¹æ€§çš„è®­ç»ƒæ”¹è¿›å»ºè®®å’ŒæŠ€èƒ½æå‡æ–¹æ¡ˆ
- **é¢„æµ‹åˆ†æ**ï¼šé¢„æµ‹æœªæ¥è¡¨ç°ï¼Œè®¾å®šåˆç†çš„ç›®æ ‡æ—¶é—´
- **æ¨¡å—åŒ–æ¶æ„**ï¼šæ”¯æŒç«å±±äº‘APIå’ŒDify AI Agentä¸¤ç§åç«¯ï¼Œä¾¿äºåˆ‡æ¢å’Œæ‰©å±•
- **ç¬¦åˆè®¾è®¡**ï¼šä¿æŒä¸ç°æœ‰UIé£æ ¼ä¸€è‡´ï¼Œä½¿ç”¨WorldSkillsä¸»é¢˜é…è‰²

## ğŸ›  æŠ€æœ¯é€‰å‹

### 1. ç«å±±äº‘å¼•æ“APIï¼ˆä¸»è¦æ–¹æ¡ˆï¼‰

**é€‰æ‹©ç†ç”±ï¼š**
- âœ… ä¸“ä¸ºä¸­æ–‡ä¼˜åŒ–çš„AIæ¨¡å‹ï¼ˆè±†åŒ…/å­—èŠ‚è·³åŠ¨å¤§æ¨¡å‹ï¼‰
- âœ… æ”¯æŒå¤šæ¨¡æ€è¾“å…¥ï¼ˆæ–‡æœ¬ã€ç»“æ„åŒ–æ•°æ®ï¼‰
- âœ… APIç¨³å®šï¼Œå“åº”é€Ÿåº¦å¿«
- âœ… æˆæœ¬å¯æ§ï¼Œæ”¯æŒå…è´¹é¢åº¦
- âœ… å›½å†…è®¿é—®ç¨³å®šï¼Œç¬¦åˆåˆè§„è¦æ±‚

**ç›¸å…³APIï¼š**
- Chat APIï¼šå¯¹è¯å¼äº¤äº’
- Function Callingï¼šç»“æ„åŒ–æ•°æ®è¾“å‡º
- Streamingï¼šæµå¼å“åº”æå‡ä½“éªŒ

### 2. Dify AI Agentï¼ˆé¢„ç•™æ‰©å±•ç‚¹ï¼‰

**é¢„ç•™ç†ç”±ï¼š**
- âœ… å¯è§†åŒ–AIå·¥ä½œæµç¼–æ’
- âœ… æ”¯æŒè‡ªå®šä¹‰çŸ¥è¯†åº“
- âœ… æ›´çµæ´»çš„Promptç®¡ç†
- âœ… æœªæ¥å¯ä»¥æ¥å…¥æ›´å¤šAIæ¨¡å‹

**æ‰©å±•ç­–ç•¥ï¼š**
- æŠ½è±¡ç»Ÿä¸€AIæœåŠ¡æ¥å£
- é…ç½®åŒ–åˆ‡æ¢åç«¯
- ä¿æŒPromptæ¨¡æ¿å…¼å®¹

### 3. ä¾èµ–ç®¡ç†

```yaml
dependencies:
  # HTTP å®¢æˆ·ç«¯
  http: ^1.2.0

  # JSONåºåˆ—åŒ–ï¼ˆå·²æœ‰ï¼‰
  json_annotation: ^4.9.0

  # ç¯å¢ƒé…ç½®
  flutter_dotenv: ^5.1.0

  # çŠ¶æ€ç®¡ç†ï¼ˆå·²æœ‰ï¼‰
  flutter_riverpod: ^2.6.1

dev_dependencies:
  # JSONä»£ç ç”Ÿæˆ
  build_runner: ^2.4.0
  json_serializable: ^6.8.0
```

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
lib/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”œâ”€â”€ ai_service_interface.dart           # AIæœåŠ¡æŠ½è±¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ volcengine_ai_service.dart          # ç«å±±äº‘AIæœåŠ¡å®ç°
â”‚   â”‚   â”œâ”€â”€ dify_ai_service.dart                # Dify AIæœåŠ¡å®ç°ï¼ˆé¢„ç•™ï¼‰
â”‚   â”‚   â”œâ”€â”€ ai_config.dart                      # AIé…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ai_providers.dart                   # Riverpod Providers
â”‚   â”‚   â””â”€â”€ prompts/
â”‚   â”‚       â”œâ”€â”€ training_analysis_prompt.dart  # è®­ç»ƒåˆ†æPromptæ¨¡æ¿
â”‚   â”‚       â”œâ”€â”€ recommendation_prompt.dart     # å»ºè®®ç”ŸæˆPromptæ¨¡æ¿
â”‚   â”‚       â””â”€â”€ dify_prompts.dart              # Difyä¸“ç”¨Promptï¼ˆé¢„ç•™ï¼‰
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ ai_analysis_result.dart            # AIåˆ†æç»“æœæ¨¡å‹
â”‚   â”œâ”€â”€ constants/
â”‚   â”‚   â””â”€â”€ ai_constants.dart                  # AIç›¸å…³å¸¸é‡
â”‚   â””â”€â”€ i18n/
â”‚       â”œâ”€â”€ strings.dart                       # æ·»åŠ AIåˆ†æç›¸å…³å­—ç¬¦ä¸²
â”‚       â”œâ”€â”€ zh.dart                            # ä¸­æ–‡ç¿»è¯‘
â”‚       â””â”€â”€ en.dart                            # è‹±æ–‡ç¿»è¯‘
â”œâ”€â”€ features/
â”‚   â””â”€â”€ practice_history/
â”‚       â””â”€â”€ widgets/
â”‚           â”œâ”€â”€ ai_insight_card.dart           # AIæ´å¯Ÿå¡ç‰‡ç»„ä»¶
â”‚           â”œâ”€â”€ ai_analysis_panel.dart         # AIåˆ†æé¢æ¿
â”‚           â”œâ”€â”€ ai_recommendation_widget.dart  # AIæ¨èç»„ä»¶
â”‚           â””â”€â”€ ai_prediction_chart.dart       # AIé¢„æµ‹å›¾è¡¨
â”œâ”€â”€ .env                                        # ç¯å¢ƒå˜é‡é…ç½®
â””â”€â”€ pubspec.yaml
```

## ğŸ— æ¶æ„è®¾è®¡

### 1. AIæœåŠ¡æŠ½è±¡å±‚

```dart
/// AIæœåŠ¡æ¥å£
abstract class AIService {
  /// åˆ†æè®­ç»ƒæ•°æ®å¹¶ç”Ÿæˆå»ºè®®
  Future<AIAnalysisResult> analyzeTrainingData({
    required List<PracticeRecord> records,
    AnalysisType type = AnalysisType.comprehensive,
  });

  /// ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®
  Future<String> generateRecommendations({
    required AIAnalysisResult analysis,
    String? customPrompt,
  });

  /// é¢„æµ‹æœªæ¥è¡¨ç°
  Future<PredictionResult> predictPerformance({
    required List<PracticeRecord> records,
    Duration targetDuration,
  });

  /// æµå¼å¯¹è¯ï¼ˆæ”¯æŒå®æ—¶äº¤äº’ï¼‰
  Stream<String> chatStream({
    required String message,
    List<ChatMessage>? history,
  });
}
```

### 2. æ•°æ®æµè®¾è®¡

```
ç”¨æˆ·è§¦å‘åˆ†æ
    â†“
è¯»å–å†å²è®°å½•ï¼ˆPracticeHistoryServiceï¼‰
    â†“
æ ¼å¼åŒ–æ•°æ®ä¸ºAIè¾“å…¥æ ¼å¼
    â†“
è°ƒç”¨AIæœåŠ¡ï¼ˆVolcengineAIServiceï¼‰
    â†“
æ¥æ”¶ç»“æ„åŒ–åˆ†æç»“æœ
    â†“
æ¸²æŸ“UIï¼ˆAIåˆ†æé¢æ¿/å›¾è¡¨ï¼‰
    â†“
ç”¨æˆ·äº¤äº’ï¼ˆè¯¢é—®/è°ƒæ•´ç›®æ ‡ï¼‰
    â†“
æµå¼å¯¹è¯è·å–è¿›ä¸€æ­¥å»ºè®®
```

### 3. APIé›†æˆè®¾è®¡

#### 3.1 ç«å±±äº‘APIé›†æˆ

**è®¤è¯æ–¹å¼ï¼š**
```dart
class VolcengineConfig {
  final String apiKey;
  final String endpoint;
  final String model;
  final int timeout;

  const VolcengineConfig({
    required this.apiKey,
    this.endpoint = 'https://ark.cn-beijing.volces.com/api/v3',
    this.model = 'ep-2024xxxx',
    this.timeout = 30,
  });
}
```

**APIè¯·æ±‚æ ¼å¼ï¼š**
```dart
{
  "model": "ep-2024xxxx",
  "messages": [
    {
      "role": "system",
      "content": "ä½ æ˜¯WorldSkillsç«èµ›è®­ç»ƒåˆ†æä¸“å®¶..."
    },
    {
      "role": "user",
      "content": "åˆ†æä»¥ä¸‹è®­ç»ƒæ•°æ®..."
    }
  ],
  "functions": [
    {
      "name": "generate_analysis",
      "description": "ç”Ÿæˆè®­ç»ƒåˆ†ææŠ¥å‘Š",
      "parameters": {
        "type": "object",
        "properties": {
          "overall_rating": {"type": "number"},
          "strengths": {"type": "array"},
          "weaknesses": {"type": "array"},
          "recommendations": {"type": "array"},
          "target_time_prediction": {"type": "string"}
        }
      }
    }
  ]
}
```

#### 3.2 Difyæ‰©å±•ç‚¹é¢„ç•™

```dart
/// Dify AIæœåŠ¡å®ç°ï¼ˆé¢„ç•™ï¼‰
class DifyAIService extends AIService {
  final String apiKey;
  final String baseUrl;
  final String appId;

  DifyAIService({
    required this.apiKey,
    this.baseUrl = 'https://api.dify.ai/v1',
    required this.appId,
  });

  // ä½¿ç”¨Difyçš„å·¥ä½œæµAPI
  @override
  Future<AIAnalysisResult> analyzeTrainingData({
    required List<PracticeRecord> records,
    AnalysisType type = AnalysisType.comprehensive,
  }) async {
    // è°ƒç”¨Difyå·¥ä½œæµ
    // é¢„ç•™å®ç°
    throw UnimplementedError('Dify integration pending');
  }
}
```

## ğŸ“Š æ•°æ®æ¨¡å‹è®¾è®¡

### 1. AIåˆ†æç»“æœæ¨¡å‹

```dart
/// AIåˆ†æç»“æœ
class AIAnalysisResult {
  /// ç»¼åˆè¯„åˆ†ï¼ˆ0-100ï¼‰
  final double overallRating;

  /// ä¼˜åŠ¿åˆ†æ
  final List<String> strengths;

  /// å¾…æ”¹è¿›ç‚¹
  final List<String> weaknesses;

  /// æ”¹è¿›å»ºè®®
  final List<TrainingRecommendation> recommendations;

  /// æ¨¡å—æ•ˆç‡åˆ†æ
  final Map<String, ModuleEfficiencyAnalysis> moduleEfficiencies;

  /// æ—¶é—´è¶‹åŠ¿åˆ†æ
  final TimeTrendAnalysis timeTrend;

  /// é¢„æµ‹çš„æœ€ä½³æ—¶é—´
  final Duration predictedBestTime;

  /// åˆ†ææ—¶é—´æˆ³
  final DateTime analyzedAt;

  /// AIä¿¡å¿ƒåº¦ï¼ˆ0-1ï¼‰
  final double confidence;
}

/// è®­ç»ƒå»ºè®®
class TrainingRecommendation {
  final String title;
  final String description;
  final RecommendationPriority priority;
  final List<String> actionSteps;
  final String? relatedModule;
}

/// æ¨¡å—æ•ˆç‡åˆ†æ
class ModuleEfficiencyAnalysis {
  final String moduleId;
  final String moduleName;
  final double efficiency;
  final List<String> insights;
  final List<String> tips;
}

/// æ—¶é—´è¶‹åŠ¿åˆ†æ
class TimeTrendAnalysis {
  final TrendType trend; // improving, stable, declining
  final double improvementRate; // æ¯æ¬¡ç»ƒä¹ çš„æ”¹è¿›ç™¾åˆ†æ¯”
  final String summary;
}

/// é¢„æµ‹ç»“æœ
class PredictionResult {
  final Duration predictedTime;
  final double confidence;
  final List<String> factors;
  final String explanation;
}

/// èŠå¤©æ¶ˆæ¯
class ChatMessage {
  final String role; // system, user, assistant
  final String content;
  final DateTime timestamp;
}
```

## ğŸ¨ UIè®¾è®¡

### 1. AIåˆ†æé¢æ¿å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI æ™ºèƒ½åˆ†æ                            [åˆ‡æ¢AIå¼•æ“: ç«å±±äº‘ â–¼] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ç»¼åˆè¯„åˆ†: 85/100                  ä¿¡å¿ƒåº¦: 92%     â”‚    â”‚
â”‚  â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘                  â”‚    â”‚
â”‚  â”‚                                                     â”‚    â”‚
â”‚  â”‚  âœ… ä½ çš„è¡¨ç°æ­£åœ¨ç¨³æ­¥æå‡ï¼Œç›¸æ¯”ä¸Šæ¬¡æå‡äº†12%          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                             â”‚
â”‚  ğŸ“Š æ ¸å¿ƒæ´å¯Ÿ                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ä¼˜åŠ¿    â”‚ éœ€æ”¹è¿›   â”‚ å»ºè®®    â”‚ é¢„æµ‹    â”‚               â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚  â”‚ â€¢ æ—¶é—´  â”‚ â€¢ ä»»åŠ¡  â”‚ â€¢ ç»ƒä¹   â”‚ æœ€ä½³:   â”‚               â”‚
â”‚  â”‚   ç®¡ç†å¼º â”‚   åˆ‡æ¢  â”‚   æ¨¡å—A â”‚ 2h30m   â”‚               â”‚
â”‚  â”‚         â”‚   æ•ˆç‡  â”‚ â€¢ ä¸“æ³¨  â”‚         â”‚               â”‚
â”‚  â”‚ â€¢ å®Œæˆ  â”‚         â”‚   ä»»åŠ¡B â”‚         â”‚               â”‚
â”‚  â”‚   ç‡é«˜  â”‚         â”‚         â”‚         â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                             â”‚
â”‚  ğŸ“ˆ æ”¹è¿›è¶‹åŠ¿å›¾                                              â”‚
â”‚  [å›¾è¡¨ï¼šæ—¶é—´è¶‹åŠ¿çº¿ + é¢„æµ‹æ›²çº¿]                              â”‚
â”‚                                                             â”‚
â”‚  ğŸ’¬ ä¸AIå¯¹è¯                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ è¾“å…¥ä½ çš„é—®é¢˜...                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚  [å‘é€]                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ç»„ä»¶å±‚æ¬¡ç»“æ„

```
AIAnalysisPanel
â”œâ”€â”€ AIHeader
â”‚   â”œâ”€â”€ Title (AIæ™ºèƒ½åˆ†æ)
â”‚   â””â”€â”€ EngineSelector
â”œâ”€â”€ AIOverviewCard
â”‚   â”œâ”€â”€ RatingGauge
â”‚   â”œâ”€â”€ SummaryText
â”‚   â””â”€â”€ ConfidenceBadge
â”œâ”€â”€ AIInsightsGrid
â”‚   â”œâ”€â”€ StrengthsColumn
â”‚   â”œâ”€â”€ WeaknessesColumn
â”‚   â”œâ”€â”€ RecommendationsColumn
â”‚   â””â”€â”€ PredictionColumn
â”œâ”€â”€ AIChartView
â”‚   â”œâ”€â”€ TimeTrendChart
â”‚   â””â”€â”€ PredictionOverlay
â””â”€â”€ AIChatPanel
    â”œâ”€â”€ ChatHistory
    â”œâ”€â”€ InputField
    â””â”€â”€ SendButton
```

## ğŸš€ å®æ–½æ­¥éª¤

### Phase 1: åŸºç¡€è®¾æ–½æ­å»ºï¼ˆç¬¬1å‘¨ï¼‰

#### æ­¥éª¤ 1: æ·»åŠ ä¾èµ–å’Œé…ç½®

**æ–‡ä»¶ï¼š`pubspec.yaml`**

```yaml
dependencies:
  http: ^1.2.0
  json_annotation: ^4.9.0
  flutter_dotenv: ^5.1.0

dev_dependencies:
  json_serializable: ^6.8.0
```

**æ–‡ä»¶ï¼š`.env`**

```env
# ç«å±±äº‘APIé…ç½®
VOLCENGINE_API_KEY=your_api_key_here
VOLCENGINE_ENDPOINT=https://ark.cn-beijing.volces.com/api/v3
VOLCENGINE_MODEL=ep-2024xxxx

# Difyé…ç½®ï¼ˆé¢„ç•™ï¼‰
DIFY_API_KEY=your_dify_api_key_here
DIFY_BASE_URL=https://api.dify.ai/v1
DIFY_APP_ID=your_app_id_here

# AIå¼•æ“é€‰æ‹©ï¼švolcengine æˆ– dify
AI_ENGINE=volcengine
```

#### æ­¥éª¤ 2: åˆ›å»ºAIæœåŠ¡æŠ½è±¡å±‚

**æ–‡ä»¶ï¼š`lib/core/ai/ai_service_interface.dart`**

```dart
import '../models/ai_analysis_result.dart';
import '../models/practice_record_model.dart';

/// åˆ†æç±»å‹
enum AnalysisType {
  comprehensive,
  efficiency,
  timeTrend,
  prediction,
  weaknessAnalysis,
}

/// AIæœåŠ¡æ¥å£
abstract class AIService {
  /// åˆ†æè®­ç»ƒæ•°æ®å¹¶ç”Ÿæˆå»ºè®®
  Future<AIAnalysisResult> analyzeTrainingData({
    required List<PracticeRecord> records,
    AnalysisType type = AnalysisType.comprehensive,
  });

  /// ç”Ÿæˆä¸ªæ€§åŒ–å»ºè®®
  Future<String> generateRecommendations({
    required AIAnalysisResult analysis,
    String? customPrompt,
  });

  /// é¢„æµ‹æœªæ¥è¡¨ç°
  Future<PredictionResult> predictPerformance({
    required List<PracticeRecord> records,
    Duration? targetDuration,
  });

  /// æµå¼å¯¹è¯ï¼ˆæ”¯æŒå®æ—¶äº¤äº’ï¼‰
  Stream<String> chatStream({
    required String message,
    List<ChatMessage>? history,
  });

  /// è·å–æœåŠ¡åç§°
  String get serviceName;

  /// æ˜¯å¦å¯ç”¨
  bool get isAvailable;
}
```

#### æ­¥éª¤ 3: åˆ›å»ºAIæ•°æ®æ¨¡å‹

**æ–‡ä»¶ï¼š`lib/core/models/ai_analysis_result.dart`**

```dart
import 'package:json_annotation/json_annotation.dart';

part 'ai_analysis_result.g.dart';

/// æ¨èä¼˜å…ˆçº§
enum RecommendationPriority {
  high,
  medium,
  low,
}

/// è¶‹åŠ¿ç±»å‹
enum TrendType {
  improving,
  stable,
  declining,
}

/// è®­ç»ƒå»ºè®®
@JsonSerializable()
class TrainingRecommendation {
  final String title;
  final String description;
  @JsonKey(name: 'priority')
  final RecommendationPriority priority;
  @JsonKey(name: 'action_steps')
  final List<String> actionSteps;
  @JsonKey(name: 'related_module')
  final String? relatedModule;

  TrainingRecommendation({
    required this.title,
    required this.description,
    required this.priority,
    required this.actionSteps,
    this.relatedModule,
  });

  factory TrainingRecommendation.fromJson(Map<String, dynamic> json) =>
      _$TrainingRecommendationFromJson(json);

  Map<String, dynamic> toJson() => _$TrainingRecommendationToJson(this);
}

/// æ¨¡å—æ•ˆç‡åˆ†æ
@JsonSerializable()
class ModuleEfficiencyAnalysis {
  @JsonKey(name: 'module_id')
  final String moduleId;
  @JsonKey(name: 'module_name')
  final String moduleName;
  final double efficiency;
  final List<String> insights;
  final List<String> tips;

  ModuleEfficiencyAnalysis({
    required this.moduleId,
    required this.moduleName,
    required this.efficiency,
    required this.insights,
    required this.tips,
  });

  factory ModuleEfficiencyAnalysis.fromJson(Map<String, dynamic> json) =>
      _$ModuleEfficiencyAnalysisFromJson(json);

  Map<String, dynamic> toJson() => _$ModuleEfficiencyAnalysisToJson(this);
}

/// æ—¶é—´è¶‹åŠ¿åˆ†æ
@JsonSerializable()
class TimeTrendAnalysis {
  final TrendType trend;
  @JsonKey(name: 'improvement_rate')
  final double improvementRate;
  final String summary;

  TimeTrendAnalysis({
    required this.trend,
    required this.improvementRate,
    required this.summary,
  });

  factory TimeTrendAnalysis.fromJson(Map<String, dynamic> json) =>
      _$TimeTrendAnalysisFromJson(json);

  Map<String, dynamic> toJson() => _$TimeTrendAnalysisToJson(this);
}

/// AIåˆ†æç»“æœ
@JsonSerializable()
class AIAnalysisResult {
  @JsonKey(name: 'overall_rating')
  final double overallRating;
  final List<String> strengths;
  final List<String> weaknesses;
  final List<TrainingRecommendation> recommendations;
  @JsonKey(name: 'module_efficiencies')
  final Map<String, ModuleEfficiencyAnalysis> moduleEfficiencies;
  @JsonKey(name: 'time_trend')
  final TimeTrendAnalysis timeTrend;
  @JsonKey(name: 'predicted_best_time')
  final Duration predictedBestTime;
  @JsonKey(name: 'analyzed_at')
  final DateTime analyzedAt;
  final double confidence;

  AIAnalysisResult({
    required this.overallRating,
    required this.strengths,
    required this.weaknesses,
    required this.recommendations,
    required this.moduleEfficiencies,
    required this.timeTrend,
    required this.predictedBestTime,
    required this.analyzedAt,
    required this.confidence,
  });

  factory AIAnalysisResult.fromJson(Map<String, dynamic> json) =>
      _$AIAnalysisResultFromJson(json);

  Map<String, dynamic> toJson() => _$AIAnalysisResultToJson(this);
}

/// é¢„æµ‹ç»“æœ
@JsonSerializable()
class PredictionResult {
  @JsonKey(name: 'predicted_time')
  final Duration predictedTime;
  final double confidence;
  final List<String> factors;
  final String explanation;

  PredictionResult({
    required this.predictedTime,
    required this.confidence,
    required this.factors,
    required this.explanation,
  });

  factory PredictionResult.fromJson(Map<String, dynamic> json) =>
      _$PredictionResultFromJson(json);

  Map<String, dynamic> toJson() => _$PredictionResultToJson(this);
}

/// èŠå¤©æ¶ˆæ¯
@JsonSerializable()
class ChatMessage {
  final String role;
  final String content;
  @JsonKey(name: 'timestamp')
  final DateTime timestamp;

  ChatMessage({
    required this.role,
    required this.content,
    required this.timestamp,
  });

  factory ChatMessage.fromJson(Map<String, dynamic> json) =>
      _$ChatMessageFromJson(json);

  Map<String, dynamic> toJson() => _$ChatMessageToJson(this);
}
```

### Phase 2: ç«å±±äº‘APIå®ç°ï¼ˆç¬¬2å‘¨ï¼‰

#### æ­¥éª¤ 4: åˆ›å»ºç«å±±äº‘AIæœåŠ¡

**æ–‡ä»¶ï¼š`lib/core/ai/volcengine_ai_service.dart`**

```dart
import 'dart:convert';
import 'package:http/http.dart' as http;
import '../constants/ws_colors.dart';
import '../models/ai_analysis_result.dart';
import '../models/practice_record_model.dart';
import 'ai_service_interface.dart';
import 'ai_config.dart';
import 'prompts/training_analysis_prompt.dart';

/// ç«å±±äº‘AIæœåŠ¡å®ç°
class VolcengineAIService extends AIService {
  final VolcengineConfig _config;
  final http.Client _client;

  VolcengineAIService({
    VolcengineConfig? config,
    http.Client? client,
  })  : _config = config ?? const VolcengineConfig(),
        _client = client ?? http.Client();

  @override
  String get serviceName => 'ç«å±±äº‘AI';

  @override
  bool get isAvailable => _config.apiKey.isNotEmpty;

  @override
  Future<AIAnalysisResult> analyzeTrainingData({
    required List<PracticeRecord> records,
    AnalysisType type = AnalysisType.comprehensive,
  }) async {
    if (!isAvailable) {
      throw Exception('ç«å±±äº‘AIæœåŠ¡æœªé…ç½®');
    }

    if (records.isEmpty) {
      throw Exception('æ²¡æœ‰å¯åˆ†æçš„è®­ç»ƒè®°å½•');
    }

    try {
      // æ ¼å¼åŒ–æ•°æ®ä¸ºAIè¾“å…¥
      final prompt = TrainingAnalysisPrompt.formatRecords(records, type);

      // æ„å»ºAPIè¯·æ±‚
      final requestBody = {
        'model': _config.model,
        'messages': [
          {
            'role': 'system',
            'content': TrainingAnalysisPrompt.systemPrompt,
          },
          {
            'role': 'user',
            'content': prompt,
          },
        ],
        'temperature': 0.7,
        'max_tokens': 2000,
        'functions': TrainingAnalysisPrompt.functions,
        'function_call': {'name': 'generate_analysis'},
      };

      // å‘é€è¯·æ±‚
      final response = await _client.post(
        Uri.parse('$_config.endpoint/chat/completions'),
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ${_config.apiKey}',
        },
        body: jsonEncode(requestBody),
      ).timeout(
        Duration(seconds: _config.timeout),
      );

      if (response.statusCode != 200) {
        throw Exception('APIè¯·æ±‚å¤±è´¥: ${response.statusCode}');
      }

      final data = jsonDecode(utf8.decode(response.bodyBytes));
      final functionCall = data['choices'][0]['message']['function_call'];
      final functionArgs = jsonDecode(functionCall['arguments']);

      // è§£æç»“æ„åŒ–ç»“æœ
      return _parseAnalysisResult(functionArgs);
    } catch (e) {
      throw Exception('åˆ†æå¤±è´¥: $e');
    }
  }

  @override
  Future<String> generateRecommendations({
    required AIAnalysisResult analysis,
    String? customPrompt,
  }) async {
    final prompt = customPrompt ??
        '''
åŸºäºä»¥ä¸‹åˆ†æç»“æœï¼Œæä¾›å…·ä½“çš„æ”¹è¿›å»ºè®®ï¼š

ç»¼åˆè¯„åˆ†: ${analysis.overallRating}/100
ä¼˜åŠ¿: ${analysis.strengths.join(', ')}
å¾…æ”¹è¿›: ${analysis.weaknesses.join(', ')}

è¯·æä¾›3-5æ¡å…·ä½“çš„ã€å¯æ‰§è¡Œçš„å»ºè®®ã€‚
''';

    final response = await _chatWithAI(prompt);
    return response;
  }

  @override
  Future<PredictionResult> predictPerformance({
    required List<PracticeRecord> records,
    Duration? targetDuration,
  }) async {
    if (!isAvailable) {
      throw Exception('ç«å±±äº‘AIæœåŠ¡æœªé…ç½®');
    }

    final prompt = TrainingAnalysisPrompt.buildPredictionPrompt(
      records,
      targetDuration,
    );

    final response = await _chatWithAI(prompt, useFunctionCalling: false);

    // ç®€åŒ–å¤„ç†ï¼šä»å“åº”ä¸­æå–é¢„æµ‹ä¿¡æ¯
    final predictedTime = _extractPredictedTime(response);
    final confidence = _extractConfidence(response);

    return PredictionResult(
      predictedTime: predictedTime,
      confidence: confidence,
      factors: _extractFactors(response),
      explanation: response,
    );
  }

  @override
  Stream<String> chatStream({
    required String message,
    List<ChatMessage>? history,
  }) async* {
    if (!isAvailable) {
      yield 'é”™è¯¯ï¼šAIæœåŠ¡æœªé…ç½®';
      return;
    }

    try {
      final messages = [
        {'role': 'system', 'content': TrainingAnalysisPrompt.systemPrompt},
        ...?history?.map((m) => {
              'role': m.role,
              'content': m.content,
            }),
        {'role': 'user', 'content': message},
      ];

      final requestBody = {
        'model': _config.model,
        'messages': messages,
        'stream': true,
        'temperature': 0.7,
      };

      final request = http.Request(
        'POST',
        Uri.parse('$_config.endpoint/chat/completions'),
      );
      request.headers.addAll({
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ${_config.apiKey}',
      });
      request.body = jsonEncode(requestBody);

      final streamedResponse = await _client.send(request);

      await for (final chunk in streamedResponse.stream) {
        final lines = utf8.decode(chunk).split('\n');
        for (final line in lines) {
          if (line.startsWith('data: ')) {
            final data = line.substring(6);
            if (data == '[DONE]') continue;

            try {
              final json = jsonDecode(data);
              final content = json['choices'][0]['delta']['content'];
              if (content != null) {
                yield content;
              }
            } catch (e) {
              // å¿½ç•¥è§£æé”™è¯¯
            }
          }
        }
      }
    } catch (e) {
      yield 'é”™è¯¯: $e';
    }
  }

  Future<String> _chatWithAI(
    String prompt, {
    bool useFunctionCalling = false,
  }) async {
    final response = await _client.post(
      Uri.parse('$_config.endpoint/chat/completions'),
      headers: {
        'Content-Type': 'application/json',
        'Authorization': 'Bearer ${_config.apiKey}',
      },
      body: jsonEncode({
        'model': _config.model,
        'messages': [
          {
            'role': 'system',
            'content': TrainingAnalysisPrompt.systemPrompt,
          },
          {
            'role': 'user',
            'content': prompt,
          },
        ],
        'temperature': 0.7,
        'max_tokens': 1000,
      }),
    );

    final data = jsonDecode(utf8.decode(response.bodyBytes));
    return data['choices'][0]['message']['content'];
  }

  AIAnalysisResult _parseAnalysisResult(Map<String, dynamic> args) {
    return AIAnalysisResult(
      overallRating: (args['overall_rating'] as num).toDouble(),
      strengths: List<String>.from(args['strengths']),
      weaknesses: List<String>.from(args['weaknesses']),
      recommendations: (args['recommendations'] as List)
          .map((r) => TrainingRecommendation.fromJson(r))
          .toList(),
      moduleEfficiencies: Map.fromEntries(
        (args['module_efficiencies'] as Map).entries.map((e) =>
            MapEntry(e.key, ModuleEfficiencyAnalysis.fromJson(e.value))),
      ),
      timeTrend: TimeTrendAnalysis.fromJson(args['time_trend']),
      predictedBestTime:
          Duration(seconds: args['predicted_best_time'] as int),
      analyzedAt: DateTime.now(),
      confidence: (args['confidence'] as num).toDouble(),
    );
  }

  Duration _extractPredictedTime(String response) {
    // ç®€åŒ–å®ç°ï¼šä»å“åº”ä¸­æå–æ—¶é—´
    final regex = RegExp(r'(\d+)å°æ—¶(\d+)åˆ†é’Ÿ');
    final match = regex.firstMatch(response);
    if (match != null) {
      final hours = int.parse(match.group(1)!);
      final minutes = int.parse(match.group(2)!);
      return Duration(hours: hours, minutes: minutes);
    }
    return const Duration(hours: 2, minutes: 30);
  }

  double _extractConfidence(String response) {
    // ç®€åŒ–å®ç°
    final regex = RegExp(r'ä¿¡å¿ƒåº¦[ï¼š:]\s*(\d+)');
    final match = regex.firstMatch(response);
    if (match != null) {
      return int.parse(match.group(1)!) / 100;
    }
    return 0.85;
  }

  List<String> _extractFactors(String response) {
    // ç®€åŒ–å®ç°
    return ['æ—¶é—´è¶‹åŠ¿ç¨³å®š', 'æ•ˆç‡æŒç»­æå‡', 'ä»»åŠ¡å®Œæˆç‡é«˜'];
  }
}
```

#### æ­¥éª¤ 5: åˆ›å»ºPromptæ¨¡æ¿

**æ–‡ä»¶ï¼š`lib/core/ai/prompts/training_analysis_prompt.dart`**

```dart
import '../../models/practice_record_model.dart';
import 'ai_service_interface.dart';

/// è®­ç»ƒåˆ†æPromptæ¨¡æ¿
class TrainingAnalysisPrompt {
  /// ç³»ç»ŸPrompt
  static const String systemPrompt = '''
ä½ æ˜¯WorldSkills 2026ç«èµ›è®­ç»ƒåˆ†æä¸“å®¶ï¼Œä¸“ç²¾äºæŠ€èƒ½è®­ç»ƒæ•°æ®åˆ†æã€‚

ä½ çš„ä»»åŠ¡æ˜¯ï¼š
1. åˆ†æç”¨æˆ·çš„è®­ç»ƒå†å²è®°å½•ï¼Œè¯†åˆ«ä¼˜åŠ¿å’Œæ”¹è¿›ç©ºé—´
2. æä¾›å…·ä½“ã€å¯æ‰§è¡Œçš„è®­ç»ƒå»ºè®®
3. é¢„æµ‹ç”¨æˆ·åœ¨ç«èµ›ä¸­çš„å¯èƒ½è¡¨ç°
4. ä½¿ç”¨ä¸“ä¸šã€é¼“åŠ±çš„è¯­æ°”

åˆ†æç»´åº¦ï¼š
- æ—¶é—´ç®¡ç†ï¼šæ€»ä½“æ—¶é•¿ã€æ¨¡å—æ—¶é—´åˆ†é…ã€ä»»åŠ¡åˆ‡æ¢æ•ˆç‡
- æ•ˆç‡è¡¨ç°ï¼šå®Œæˆç‡ã€å‡†ç¡®ç‡ã€ä¸é¢„ä¼°æ—¶é—´çš„å¯¹æ¯”
- è¶‹åŠ¿åˆ†æï¼šè¿›æ­¥é€Ÿåº¦ã€ç¨³å®šæ€§ã€æ³¢åŠ¨æ€§
- æ¨¡å—è¡¨ç°ï¼šå„æ¨¡å—çš„å¼ºé¡¹å’Œå¼±é¡¹

è¾“å‡ºè¦æ±‚ï¼š
- æ•°æ®é©±åŠ¨ï¼šåŸºäºå®é™…æ•°æ®ç»™å‡ºåˆ†æ
- å…·ä½“åŒ–ï¼šé¿å…ç©ºæ³›çš„å»ºè®®
- å»ºè®¾æ€§ï¼šæŒ‡å‡ºé—®é¢˜çš„åŒæ—¶ç»™å‡ºè§£å†³æ–¹æ¡ˆ
- é‡åŒ–æŒ‡æ ‡ï¼šä½¿ç”¨å…·ä½“æ•°å­—æ”¯æ’‘åˆ†æ
''';

  /// Function Callingå®šä¹‰
  static const List<Map<String, dynamic>> functions = [
    {
      'name': 'generate_analysis',
      'description': 'ç”Ÿæˆè®­ç»ƒåˆ†ææŠ¥å‘Š',
      'parameters': {
        'type': 'object',
        'properties': {
          'overall_rating': {
            'type': 'number',
            'description': 'ç»¼åˆè¯„åˆ†ï¼ˆ0-100ï¼‰',
          },
          'strengths': {
            'type': 'array',
            'description': 'ç”¨æˆ·çš„ä¼˜åŠ¿ï¼ˆ3-5æ¡ï¼‰',
            'items': {'type': 'string'},
          },
          'weaknesses': {
            'type': 'array',
            'description': 'éœ€è¦æ”¹è¿›çš„æ–¹é¢ï¼ˆ3-5æ¡ï¼‰',
            'items': {'type': 'string'},
          },
          'recommendations': {
            'type': 'array',
            'description': 'æ”¹è¿›å»ºè®®',
            'items': {
              'type': 'object',
              'properties': {
                'title': {'type': 'string'},
                'description': {'type': 'string'},
                'priority': {
                  'type': 'string',
                  'enum': ['high', 'medium', 'low'],
                },
                'action_steps': {
                  'type': 'array',
                  'items': {'type': 'string'},
                },
                'related_module': {'type': 'string'},
              },
            },
          },
          'module_efficiencies': {
            'type': 'object',
            'description': 'å„æ¨¡å—æ•ˆç‡åˆ†æ',
            'additionalProperties': {
              'type': 'object',
              'properties': {
                'module_id': {'type': 'string'},
                'module_name': {'type': 'string'},
                'efficiency': {'type': 'number'},
                'insights': {
                  'type': 'array',
                  'items': {'type': 'string'},
                },
                'tips': {
                  'type': 'array',
                  'items': {'type': 'string'},
                },
              },
            },
          },
          'time_trend': {
            'type': 'object',
            'properties': {
              'trend': {
                'type': 'string',
                'enum': ['improving', 'stable', 'declining'],
              },
              'improvement_rate': {'type': 'number'},
              'summary': {'type': 'string'},
            },
          },
          'predicted_best_time': {
            'type': 'number',
            'description': 'é¢„æµ‹çš„æœ€ä½³å®Œæˆæ—¶é—´ï¼ˆç§’ï¼‰',
          },
          'confidence': {
            'type': 'number',
            'description': 'AIä¿¡å¿ƒåº¦ï¼ˆ0-1ï¼‰',
          },
        },
        'required': [
          'overall_rating',
          'strengths',
          'weaknesses',
          'recommendations',
          'module_efficiencies',
          'time_trend',
          'predicted_best_time',
          'confidence',
        ],
      },
    },
  ];

  /// æ ¼å¼åŒ–è®­ç»ƒè®°å½•ä¸ºPrompt
  static String formatRecords(
    List<PracticeRecord> records,
    AnalysisType type,
  ) {
    final buffer = StringBuffer();

    buffer.writeln('è¯·åˆ†æä»¥ä¸‹è®­ç»ƒæ•°æ®ï¼š\n');

    // æ€»ä½“ç»Ÿè®¡
    final totalRecords = records.length;
    final totalDuration = records.fold<Duration>(
      Duration.zero,
      (sum, r) => sum + r.totalDuration,
    );
    final avgDuration =
        Duration(seconds: totalDuration.inSeconds ~/ totalRecords);
    final avgEfficiency =
        records.fold<double>(0, (sum, r) => sum + r.efficiency) /
            totalRecords;

    buffer.writeln('æ€»ä½“ç»Ÿè®¡ï¼š');
    buffer.writeln('- æ€»è®°å½•æ•°: $totalRecords');
    buffer.writeln('- æ€»æ—¶é•¿: ${_formatDuration(totalDuration)}');
    buffer.writeln('- å¹³å‡æ—¶é•¿: ${_formatDuration(avgDuration)}');
    buffer.writeln('- å¹³å‡æ•ˆç‡: ${(avgEfficiency * 100).toInt()}%\n');

    // æŒ‰æ¨¡å—åˆ†ç»„
    final moduleGroups = <String, List<PracticeRecord>>{};
    for (final record in records) {
      moduleGroups.putIfAbsent(record.moduleId, () => []).add(record);
    }

    buffer.writeln('æ¨¡å—åˆ†æï¼š');
    for (final entry in moduleGroups.entries) {
      final moduleRecords = entry.value;
      final moduleAvg = moduleRecords.fold<Duration>(
        Duration.zero,
        (sum, r) => sum + r.totalDuration,
      );
      final moduleAvgDuration =
          Duration(seconds: moduleAvg.inSeconds ~/ moduleRecords.length);
      final moduleAvgEfficiency = moduleRecords.fold<double>(
        0,
        (sum, r) => sum + r.efficiency,
      ) / moduleRecords.length;

      buffer.writeln(
        '\næ¨¡å—: ${moduleRecords.first.moduleName} (${entry.key})',
      );
      buffer.writeln('  - ç»ƒä¹ æ¬¡æ•°: ${moduleRecords.length}');
      buffer.writeln('  - å¹³å‡æ—¶é•¿: ${_formatDuration(moduleAvgDuration)}');
      buffer.writeln('  - å¹³å‡æ•ˆç‡: ${(moduleAvgEfficiency * 100).toInt()}%');

      // æ—¶é—´è¶‹åŠ¿
      moduleRecords.sort((a, b) => a.completedAt.compareTo(b.completedAt));
      if (moduleRecords.length > 1) {
        final firstDuration = moduleRecords.first.totalDuration.inSeconds;
        final lastDuration = moduleRecords.last.totalDuration.inSeconds;
        final improvement = ((firstDuration - lastDuration) / firstDuration * 100);
        buffer.writeln('  - æ—¶é—´æ”¹è¿›: ${improvement.toStringAsFixed(1)}%');
      }

      // ä»»åŠ¡åˆ†æ
      for (final record in moduleRecords) {
        if (record.taskRecords.isNotEmpty) {
          buffer.writeln('  - ä»»åŠ¡å®Œæˆç‡: ${record.completedTasks}/${record.totalTasks}');
        }
      }
    }

    // æ ¹æ®åˆ†æç±»å‹æ·»åŠ ç‰¹å®šè¦æ±‚
    buffer.writeln('\nåˆ†æè¦æ±‚ï¼š');
    switch (type) {
      case AnalysisType.comprehensive:
        buffer.writeln('- æä¾›å…¨é¢çš„åˆ†æï¼ŒåŒ…æ‹¬æ‰€æœ‰ç»´åº¦');
        break;
      case AnalysisType.efficiency:
        buffer.writeln('- é‡ç‚¹å…³æ³¨æ•ˆç‡åˆ†æ');
        break;
      case AnalysisType.timeTrend:
        buffer.writeln('- é‡ç‚¹å…³æ³¨æ—¶é—´è¶‹åŠ¿å’Œæ”¹è¿›é€Ÿåº¦');
        break;
      case AnalysisType.prediction:
        buffer.writeln('- é‡ç‚¹å…³æ³¨æœªæ¥è¡¨ç°é¢„æµ‹');
        break;
      case AnalysisType.weaknessAnalysis:
        buffer.writeln('- é‡ç‚¹å…³æ³¨å¾…æ”¹è¿›ç‚¹å’Œè§£å†³æ–¹æ¡ˆ');
        break;
    }

    return buffer.toString();
  }

  /// æ„å»ºé¢„æµ‹Prompt
  static String buildPredictionPrompt(
    List<PracticeRecord> records,
    Duration? targetDuration,
  ) {
    final buffer = StringBuffer();
    buffer.writeln('åŸºäºä»¥ä¸‹è®­ç»ƒæ•°æ®ï¼Œé¢„æµ‹æœªæ¥çš„è¡¨ç°ï¼š\n');
    buffer.writeln(formatRecords(records, AnalysisType.prediction));

    if (targetDuration != null) {
      buffer.writeln('\nç›®æ ‡æ—¶é•¿: ${_formatDuration(targetDuration)}');
      buffer.writeln('è¯·åˆ†æè¾¾æˆç›®æ ‡çš„å¯èƒ½æ€§ï¼Œå¹¶æä¾›æ”¹è¿›å»ºè®®ã€‚');
    }

    return buffer.toString();
  }

  static String _formatDuration(Duration duration) {
    final hours = duration.inHours;
    final minutes = duration.inMinutes % 60;
    final seconds = duration.inSeconds % 60;

    if (hours > 0) {
      return '${hours}å°æ—¶${minutes}åˆ†é’Ÿ';
    } else if (minutes > 0) {
      return '${minutes}åˆ†é’Ÿ${seconds}ç§’';
    } else {
      return '${seconds}ç§’';
    }
  }
}
```

#### æ­¥éª¤ 6: åˆ›å»ºAIé…ç½®ç®¡ç†

**æ–‡ä»¶ï¼š`lib/core/ai/ai_config.dart`**

```dart
import 'package:flutter_dotenv/flutter_dotenv.dart';

/// ç«å±±äº‘é…ç½®
class VolcengineConfig {
  final String apiKey;
  final String endpoint;
  final String model;
  final int timeout;

  const VolcengineConfig({
    required this.apiKey,
    this.endpoint = 'https://ark.cn-beijing.volces.com/api/v3',
    this.model = 'ep-2024xxxx',
    this.timeout = 30,
  });

  factory VolcengineConfig.fromEnv() {
    return VolcengineConfig(
      apiKey: dotenv.env['VOLCENGINE_API_KEY'] ?? '',
      endpoint: dotenv.env['VOLCENGINE_ENDPOINT'] ??
          'https://ark.cn-beijing.volces.com/api/v3',
      model: dotenv.env['VOLCENGINE_MODEL'] ?? 'ep-2024xxxx',
      timeout: int.tryParse(dotenv.env['VOLCENGINE_TIMEOUT'] ?? '30') ?? 30,
    );
  }
}

/// Difyé…ç½®ï¼ˆé¢„ç•™ï¼‰
class DifyConfig {
  final String apiKey;
  final String baseUrl;
  final String appId;

  const DifyConfig({
    required this.apiKey,
    this.baseUrl = 'https://api.dify.ai/v1',
    required this.appId,
  });

  factory DifyConfig.fromEnv() {
    return DifyConfig(
      apiKey: dotenv.env['DIFY_API_KEY'] ?? '',
      baseUrl: dotenv.env['DIFY_BASE_URL'] ?? 'https://api.dify.ai/v1',
      appId: dotenv.env['DIFY_APP_ID'] ?? '',
    );
  }
}

/// AIé…ç½®
class AIConfig {
  final VolcengineConfig volcengineConfig;
  final DifyConfig difyConfig;
  final AIEngine defaultEngine;

  const AIConfig({
    VolcengineConfig? volcengineConfig,
    DifyConfig? difyConfig,
    this.defaultEngine = AIEngine.volcengine,
  })  : volcengineConfig = volcengineConfig ?? const VolcengineConfig(),
        difyConfig = difyConfig ?? const DifyConfig();

  factory AIConfig.fromEnv() {
    final engineStr = dotenv.env['AI_ENGINE'] ?? 'volcengine';
    final engine = AIEngine.values.firstWhere(
      (e) => e.name == engineStr,
      orElse: () => AIEngine.volcengine,
    );

    return AIConfig(
      volcengineConfig: VolcengineConfig.fromEnv(),
      difyConfig: DifyConfig.fromEnv(),
      defaultEngine: engine,
    );
  }
}

/// AIå¼•æ“ç±»å‹
enum AIEngine {
  volcengine,
  dify,
}
```

### Phase 3: UIå®ç°ï¼ˆç¬¬3å‘¨ï¼‰

#### æ­¥éª¤ 7: åˆ›å»ºAIåˆ†æé¢æ¿

**æ–‡ä»¶ï¼š`lib/features/practice_history/widgets/ai_analysis_panel.dart`**

```dart
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import '../../../core/constants/ws_colors.dart';
import '../../../core/i18n/locale_provider.dart';
import '../../../core/models/ai_analysis_result.dart';
import '../../../core/ai/ai_providers.dart';
import '../../core/providers/practice_history_provider.dart';
import 'ai_overview_card.dart';
import 'ai_insights_grid.dart';
import 'ai_chart_view.dart';
import 'ai_chat_panel.dart';

/// AIåˆ†æé¢æ¿
class AIAnalysisPanel extends ConsumerStatefulWidget {
  const AIAnalysisPanel({super.key});

  @override
  ConsumerState<AIAnalysisPanel> createState() => _AIAnalysisPanelState();
}

class _AIAnalysisPanelState extends ConsumerState<AIAnalysisPanel> {
  @override
  Widget build(BuildContext context) {
    final s = LocaleScope.of(context);
    final recordsAsync = ref.watch(practiceRecordsProvider);
    final analysisAsync = ref.watch(aiAnalysisProvider);

    return recordsAsync.when(
      data: (records) {
        if (records.isEmpty) {
          return _buildEmptyState(s);
        }

        return Column(
          children: [
            // æ ‡é¢˜æ 
            _buildHeader(s),
            const SizedBox(height: 16),

            // åˆ†æå†…å®¹
            Expanded(
              child: analysisAsync.when(
                data: (analysis) => _buildAnalysisContent(analysis),
                loading: () => _buildLoadingState(),
                error: (err, stack) => _buildErrorState(err),
              ),
            ),
          ],
        );
      },
      loading: () => const Center(child: CircularProgressIndicator()),
      error: (err, stack) => Center(child: Text('Error: $err')),
    );
  }

  Widget _buildHeader(dynamic s) {
    return Container(
      padding: const EdgeInsets.all(16),
      decoration: BoxDecoration(
        color: WsColors.surface,
        border: Border(
          bottom: BorderSide(color: WsColors.border),
        ),
      ),
      child: Row(
        children: [
          Container(
            padding: const EdgeInsets.all(8),
            decoration: BoxDecoration(
              color: WsColors.accentCyan.withAlpha(25),
              borderRadius: BorderRadius.circular(8),
            ),
            child: const Icon(
              Icons.auto_awesome,
              color: WsColors.accentCyan,
            ),
          ),
          const SizedBox(width: 12),
          Expanded(
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  s.aiAnalysis,
                  style: const TextStyle(
                    fontSize: 18,
                    fontWeight: FontWeight.bold,
                    color: WsColors.textPrimary,
                  ),
                ),
                Text(
                  s.aiAnalysisDesc,
                  style: const TextStyle(
                    fontSize: 12,
                    color: WsColors.textSecondary,
                  ),
                ),
              ],
            ),
          ),
          // AIå¼•æ“é€‰æ‹©å™¨ï¼ˆé¢„ç•™ï¼‰
          _buildEngineSelector(s),
        ],
      ),
    );
  }

  Widget _buildEngineSelector(dynamic s) {
    return Container(
      padding: const EdgeInsets.symmetric(horizontal: 12, vertical: 6),
      decoration: BoxDecoration(
        color: WsColors.bgDeep.withAlpha(120),
        borderRadius: BorderRadius.circular(8),
        border: Border.all(color: WsColors.border),
      ),
      child: Row(
        children: [
          const Icon(
            Icons.memory,
            size: 16,
            color: WsColors.accentCyan,
          ),
          const SizedBox(width: 6),
          Text(
            'ç«å±±äº‘AI',
            style: const TextStyle(
              fontSize: 12,
              fontWeight: FontWeight.w600,
              color: WsColors.textPrimary,
            ),
          ),
        ],
      ),
    );
  }

  Widget _buildAnalysisContent(AIAnalysisResult analysis) {
    return SingleChildScrollView(
      padding: const EdgeInsets.all(16),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          // æ¦‚è§ˆå¡ç‰‡
          AIOverviewCard(analysis: analysis),
          const SizedBox(height: 24),

          // æ´å¯Ÿç½‘æ ¼
          AIInsightsGrid(analysis: analysis),
          const SizedBox(height: 24),

          // å›¾è¡¨è§†å›¾
          AIChartView(analysis: analysis),
          const SizedBox(height: 24),

          // èŠå¤©é¢æ¿
          AIChatPanel(analysis: analysis),
        ],
      ),
    );
  }

  Widget _buildLoadingState() {
    return const Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          CircularProgressIndicator(),
          SizedBox(height: 16),
          Text('AIæ­£åœ¨åˆ†æä½ çš„è®­ç»ƒæ•°æ®...'),
        ],
      ),
    );
  }

  Widget _buildErrorState(Object error) {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.error_outline,
            size: 64,
            color: WsColors.errorRed,
          ),
          const SizedBox(height: 16),
          Text(
            'åˆ†æå¤±è´¥',
            style: TextStyle(
              fontSize: 18,
              fontWeight: FontWeight.bold,
              color: WsColors.textPrimary,
            ),
          ),
          const SizedBox(height: 8),
          Text(
            error.toString(),
            style: TextStyle(
              fontSize: 14,
              color: WsColors.textSecondary,
            ),
            textAlign: TextAlign.center,
          ),
          const SizedBox(height: 16),
          ElevatedButton(
            onPressed: () => ref.invalidate(aiAnalysisProvider),
            child: const Text('é‡è¯•'),
          ),
        ],
      ),
    );
  }

  Widget _buildEmptyState(dynamic s) {
    return Center(
      child: Column(
        mainAxisAlignment: MainAxisAlignment.center,
        children: [
          Icon(
            Icons.psychology_outlined,
            size: 64,
            color: WsColors.textSecondary.withAlpha(80),
          ),
          const SizedBox(height: 16),
          Text(
            s.noRecords,
            style: TextStyle(
              fontSize: 16,
              color: WsColors.textSecondary,
            ),
          ),
        ],
      ),
    );
  }
}
```

#### æ­¥éª¤ 8: åˆ›å»ºAI Providers

**æ–‡ä»¶ï¼š`lib/core/ai/ai_providers.dart`**

```dart
import 'package:flutter_riverpod/flutter_riverpod.dart';
import '../features/practice_history/models/practice_record_model.dart';
import 'ai_service_interface.dart';
import 'volcengine_ai_service.dart';
import 'dify_ai_service.dart';
import 'ai_config.dart';

/// AIé…ç½®Provider
final aiConfigProvider = Provider<AIConfig>((ref) {
  return AIConfig.fromEnv();
});

/// AIæœåŠ¡Providerï¼ˆæ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©ï¼‰
final aiServiceProvider = Provider<AIService>((ref) {
  final config = ref.watch(aiConfigProvider);

  switch (config.defaultEngine) {
    case AIEngine.volcengine:
      return VolcengineAIService(config: config.volcengineConfig);
    case AIEngine.dify:
      return DifyAIService(
        apiKey: config.difyConfig.apiKey,
        appId: config.difyConfig.appId,
        baseUrl: config.difyConfig.baseUrl,
      );
  }
});

/// AIåˆ†æç»“æœProvider
final aiAnalysisProvider = FutureProvider<AIAnalysisResult>((ref) async {
  final service = ref.watch(aiServiceProvider);
  final recordsAsync = ref.watch(practiceRecordsProvider);

  final records = await recordsAsync;

  if (records.isEmpty) {
    throw Exception('æ²¡æœ‰è®­ç»ƒè®°å½•å¯åˆ†æ');
  }

  return service.analyzeTrainingData(records: records);
});

/// AIèŠå¤©å†å²Provider
final aiChatHistoryProvider =
    StateProvider<List<ChatMessage>>((ref) => []);

/// AIæ¨èProvider
final aiRecommendationsProvider =
    FutureProvider.family<String, String>((ref, customPrompt) async {
  final service = ref.watch(aiServiceProvider);
  final analysisAsync = ref.watch(aiAnalysisProvider);

  final analysis = await analysisAsync;

  return service.generateRecommendations(
    analysis: analysis,
    customPrompt: customPrompt.isEmpty ? null : customPrompt,
  );
});

/// AIé¢„æµ‹Provider
final aiPredictionProvider = FutureProvider.family<
    PredictionResult, Duration>((ref, targetDuration) async {
  final service = ref.watch(aiServiceProvider);
  final recordsAsync = ref.watch(practiceRecordsProvider);

  final records = await recordsAsync;

  return service.predictPerformance(
    records: records,
    targetDuration: targetDuration,
  );
});
```

## ğŸ“ å›½é™…åŒ–å­—ç¬¦ä¸²

### æ–‡ä»¶ï¼š`lib/core/i18n/strings.dart`

æ·»åŠ ä»¥ä¸‹å­—ç¬¦ä¸²åˆ° `AppStrings` æŠ½è±¡ç±»ï¼š

```dart
// AI Analysis
String get aiAnalysis;
String get aiAnalysisDesc;
String get aiInsights;
String get aiRecommendations;
String get aiPrediction;
String get overallRating;
String get confidence;
String get strengths;
String get weaknesses;
String get talkToAI;
String get askAI;
String get generatingAnalysis;
String get analysisComplete;
String get noAnalysisData;
```

### æ–‡ä»¶ï¼š`lib/core/i18n/zh.dart`

```dart
@override
String get aiAnalysis => 'AIæ™ºèƒ½åˆ†æ';
@override
String get aiAnalysisDesc => 'åŸºäºè®­ç»ƒæ•°æ®çš„ä¸ªæ€§åŒ–åˆ†æå’Œå»ºè®®';
@override
String get aiInsights => 'AIæ´å¯Ÿ';
@override
String get aiRecommendations => 'æ™ºèƒ½å»ºè®®';
@override
String get aiPrediction => 'æ€§èƒ½é¢„æµ‹';
@override
String get overallRating => 'ç»¼åˆè¯„åˆ†';
@override
String get confidence => 'ä¿¡å¿ƒåº¦';
@override
String get strengths => 'ä¼˜åŠ¿';
@override
String get weaknesses => 'å¾…æ”¹è¿›';
@override
String get talkToAI => 'ä¸AIå¯¹è¯';
@override
String get askAI => 'å‘AIæé—®';
@override
String get generatingAnalysis => 'AIæ­£åœ¨åˆ†æ...';
@override
String get analysisComplete => 'åˆ†æå®Œæˆ';
@override
String get noAnalysisData => 'æš‚æ— åˆ†ææ•°æ®';
```

### æ–‡ä»¶ï¼š`lib/core/i18n/en.dart`

```dart
@override
String get aiAnalysis => 'AI Analysis';
@override
String get aiAnalysisDesc => 'Personalized analysis and recommendations based on training data';
@override
String get aiInsights => 'AI Insights';
@override
String get aiRecommendations => 'Smart Recommendations';
@override
String get aiPrediction => 'Performance Prediction';
@override
String get overallRating => 'Overall Rating';
@override
String get confidence => 'Confidence';
@override
String get strengths => 'Strengths';
@override
String get weaknesses => 'Weaknesses';
@override
String get talkToAI => 'Chat with AI';
@override
String get askAI => 'Ask AI';
@override
String get generatingAnalysis => 'AI is analyzing...';
@override
String get analysisComplete => 'Analysis Complete';
@override
String get noAnalysisData => 'No analysis data';
```

## ğŸ”’ å®‰å…¨ä¸éšç§

### 1. APIå¯†é’¥ç®¡ç†

- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨APIå¯†é’¥
- âœ… .envæ–‡ä»¶åŠ å…¥.gitignore
- âœ… ç”Ÿäº§ç¯å¢ƒä½¿ç”¨å®‰å…¨çš„å¯†é’¥ç®¡ç†æœåŠ¡
- âœ… ä¸åœ¨å‰ç«¯ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥

### 2. æ•°æ®éšç§

- âœ… è®­ç»ƒæ•°æ®åªåœ¨æœ¬åœ°å¤„ç†
- âœ… å‘é€åˆ°AIçš„æ•°æ®ä»…åŒ…å«åŒ¿ååŒ–çš„ç»Ÿè®¡æ•°æ®
- âœ… ä¸å‘é€ä¸ªäººèº«ä»½ä¿¡æ¯
- âœ… æä¾›æ•°æ®åˆ é™¤é€‰é¡¹

### 3. ä½¿ç”¨é™åˆ¶

- âœ… å®ç°è¯·æ±‚é¢‘ç‡é™åˆ¶
- âœ… é”™è¯¯é‡è¯•æœºåˆ¶ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- âœ… è¶…æ—¶å¤„ç†
- âœ… ç¦»çº¿æ¨¡å¼æ”¯æŒ

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

```dart
// test/core/ai/volcengine_ai_service_test.dart
test('should parse AI response correctly', () {
  // æµ‹è¯•å“åº”è§£æ
});

test('should handle API errors gracefully', () {
  // æµ‹è¯•é”™è¯¯å¤„ç†
});

test('should format records correctly', () {
  // æµ‹è¯•æ•°æ®æ ¼å¼åŒ–
});
```

### 2. é›†æˆæµ‹è¯•

```dart
// test/features/ai_integration_test.dart
testWidgets('AI analysis panel displays results', (tester) async {
  // æµ‹è¯•UIæ˜¾ç¤º
});

testWidgets('Chat panel responds to user input', (tester) async {
  // æµ‹è¯•èŠå¤©åŠŸèƒ½
});
```

### 3. Mockæ•°æ®

åˆ›å»ºmockæ•°æ®ç”¨äºæµ‹è¯•ï¼š

```dart
// test/mocks/mock_ai_data.dart
const mockAnalysisResult = AIAnalysisResult(
  overallRating: 85.0,
  strengths: ['æ—¶é—´ç®¡ç†èƒ½åŠ›å¼º', 'å®Œæˆç‡é«˜'],
  weaknesses: ['ä»»åŠ¡åˆ‡æ¢æ•ˆç‡å¾…æå‡'],
  // ...
);
```

## ğŸ“… å®æ–½æ—¶é—´è¡¨

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | ä¾èµ– |
|------|------|----------|------|
| Phase 1 | åŸºç¡€è®¾æ–½æ­å»º | 1å‘¨ | - |
| Phase 2 | ç«å±±äº‘APIå®ç° | 1å‘¨ | Phase 1 |
| Phase 3 | UIå®ç° | 1å‘¨ | Phase 2 |
| Phase 4 | æµ‹è¯•ä¸ä¼˜åŒ– | 3å¤© | Phase 3 |
| Phase 5 | Difyæ‰©å±•ç‚¹å®ç°ï¼ˆå¯é€‰ï¼‰ | 1å‘¨ | Phase 1 |

## ğŸ¯ æˆåŠŸæ ‡å‡†

- âœ… èƒ½å¤Ÿåˆ†æè‡³å°‘10æ¡å†å²è®­ç»ƒè®°å½•
- âœ… AIåˆ†æå“åº”æ—¶é—´ < 5ç§’
- âœ… å»ºè®®å‡†ç¡®ç‡ > 80%ï¼ˆç”¨æˆ·åé¦ˆï¼‰
- âœ… æ”¯æŒä¸­è‹±æ–‡åŒè¯­
- âœ… UIå“åº”æµç•…ï¼Œæ— æ˜æ˜¾å¡é¡¿
- âœ… é”™è¯¯å¤„ç†å®Œå–„ï¼Œç”¨æˆ·å‹å¥½

## ğŸ”„ Difyæ‰©å±•ç‚¹å®ç°ï¼ˆé¢„ç•™ï¼‰

å½“éœ€è¦é›†æˆDifyæ—¶ï¼Œåªéœ€ï¼š

1. å®ç° `DifyAIService` ç±»
2. åœ¨ `ai_providers.dart` ä¸­æ·»åŠ æ”¯æŒ
3. é€šè¿‡ç¯å¢ƒå˜é‡åˆ‡æ¢å¼•æ“

```dart
// ç¤ºä¾‹ï¼šåˆ‡æ¢åˆ°Dify
// .env
AI_ENGINE=dify
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç«å±±äº‘APIæ–‡æ¡£](https://www.volcengine.com/docs/82379)
- [Difyæ–‡æ¡£](https://docs.dify.ai)
- [Riverpodæœ€ä½³å®è·µ](https://riverpod.dev/docs/concepts/providers)

## ğŸ¨ è®¾è®¡èµ„æº

- ä½¿ç”¨WorldSkillsä¸»é¢˜é…è‰²ï¼š`WsColors.accentCyan`, `WsColors.accentGreen`, `WsColors.secondaryMint`
- å›¾æ ‡ï¼šMaterial Icons - `auto_awesome`, `psychology`, `trending_up`, `lightbulb`
- å­—ä½“ï¼šInterï¼ˆUIæ–‡æœ¬ï¼‰, JetBrainsMonoï¼ˆæ•°å­—æ˜¾ç¤ºï¼‰

---

**æ³¨æ„ï¼š**
1. å®æ–½å‰è¯·å…ˆåœ¨ç«å±±äº‘æ§åˆ¶å°ç”³è¯·APIå¯†é’¥
2. å»ºè®®å…ˆç”¨æµ‹è¯•æ•°æ®éªŒè¯APIé›†æˆ
3. é¢„ç•™Difyæ‰©å±•ç‚¹ï¼Œä¾¿äºæœªæ¥å‡çº§
4. æ‰€æœ‰AIç›¸å…³é…ç½®åº”é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†
